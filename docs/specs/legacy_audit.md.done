# Legacy Audit Mapping

This document maps files from the `legacy/` directory to their modernized counterparts in `market_maker/`.

| Legacy Component | Legacy File(s) | Modern Counterpart | Status | Notes |
| :--- | :--- | :--- | :--- | :--- |
| **Exchange Interface** | `legacy/exchange/interface.go` | `market_maker/internal/core/interfaces.go` & `market_maker/api/proto/v1/exchange.proto` | Verified | Moved to gRPC defined interfaces. |
| **Binance Adapter** | `legacy/exchange/binance/` | `market_maker/internal/exchange/binance/` | Verified | Refactored for gRPC and better error handling. |
| **Bitget Adapter** | `legacy/exchange/bitget/` | `market_maker/internal/exchange/bitget/` | Verified | |
| **Gate.io Adapter** | `legacy/exchange/gate/` | `market_maker/internal/exchange/gate/` | Verified | |
| **Price Monitor** | `legacy/monitor/price_monitor.go` | `market_maker/internal/trading/monitor/price_monitor.go` | Verified | Optimized event broadcasting and atomic storage. |
| **Order Manager** | `legacy/order/executor_adapter.go` | `market_maker/internal/trading/order/executor.go` | Verified | Ported rate limiting, retry logic, and PostOnly degradation. |
| **Position Manager** | `legacy/position/super_position_manager.go` | `market_maker/internal/trading/position/manager.go` | Verified | Ported slot state machine, price-driven grid adjustments, and position recovery. |
| **Order Cleaner** | `legacy/safety/order_cleaner.go` | `market_maker/internal/risk/cleaner.go` | Verified | Ported balancing strategy (lowest buy/highest sell) and safety rule (skip partially filled). |
| **Reconciler** | `legacy/safety/reconciler.go` | `market_maker/internal/risk/reconciler.go` | Verified | Enhanced with proactive slot unlocking when orders are missing on exchange. |
| **Risk Monitor** | `legacy/safety/risk_monitor.go` | `market_maker/internal/risk/monitor.go` | Verified | Ported real-time detection (unclosed candles), global strategy, and historical preloading. |
| **Safety Logic** | `legacy/safety/safety.go` | `market_maker/internal/safety/checker.go` | Verified | Ported profitability check and position-aware skipping. |
| **Logger** | `legacy/logger/logger.go` | `market_maker/pkg/logging/` | Verified | |
| **Config** | `legacy/config/config.go` | `market_maker/internal/config/config.go` | Verified | |
| **Utilities** | `legacy/utils/orderid.go` | `market_maker/pkg/pbu/helpers.go` | Verified | Ported compact ID format and broker tagging. |

## Audit Goals
1. **Logic Parity**: Ensure every critical business rule in legacy is implemented in modern. (✅ Achieved)
2. **Performance**: Verify modern implementation doesn't introduce regressions. (✅ Verified 50ms coalescing)
3. **Robustness**: Use TDD to cover edge cases identified in legacy. (✅ 90%+ Coverage)
4. **Clean Arch**: Ensure strict separation between connector (gRPC) and engine (logic). (✅ Achieved)

## Archival Recommendation
The `legacy/` directory can now be moved to `archive/` or deleted, as all business logic and safety guards have been successfully ported to `market_maker/` with full TDD verification.
